@model TimesheetSystem.ViewModels.WeeklyTimesheetViewModel
@{
	var dateFormat = ViewBag.DateFormat as string ?? "yyyy-MM-dd";
}

<div class="card timesheet-card border-0">
	<div class="card-header d-flex justify-content-between align-items-center">
		<h4 class="mb-0">Timesheet Entries for this week</h4>
		<a asp-controller="Timesheet" asp-action="Add"
		   asp-route-userId="@Model.NavigationData.SelectedUserId"
		   asp-route-weekStart="@Model.NavigationData.WeekStartDate.ToString(dateFormat)"
		   class="btn btn-light">
			Add New Entry
		</a>
	</div>
	<div class="card-body">
		<table class="table table-striped table-hover ">
			<thead>
				<tr>
					<th>Date</th>
					<th>Project</th>
					<th>Hours</th>
					<th>Description</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				@foreach (var entry in Model.Entries)
				{
					<tr>
						<td>@entry.Date.ToString("ddd, dd MMM")</td>
						<td>
							@{
								var project = Model.ProjectTotals.FirstOrDefault(p => p.ProjectId == entry.ProjectId);
							}
							@(project?.ProjectName ?? "unknown")
						</td>
						<td>@entry.Hours.ToString("F2")</td>
						<td class="description-cell">@entry.Description</td>
						<td class="text-end">
							<a asp-controller="Timesheet"
							   asp-action="Edit"
							   asp-route-timesheetEntryId="@entry.Id"
							   asp-route-userId="@Model.NavigationData.SelectedUserId"
							   asp-route-weekStart="@Model.NavigationData.WeekStartDate.ToString(dateFormat)"
							   class="btn btn-sm btn-primary">
								Edit
							</a>
							<form asp-controller="Timesheet"
								  asp-action="DeleteEntry"
								  asp-route-id="@entry.Id"
								  asp-route-userId="@Model.NavigationData.SelectedUserId"
								  asp-route-weekStart="@Model.NavigationData.WeekStartDate.ToString(dateFormat)"
								  method="post"
								  style="display: inline;"
								  onsubmit="return confirm('Are you sure you want to delete this entry?');">
								<button type="submit" class="btn btn-outline-primary btn-sm">Delete</button>
							</form>
						</td>
					</tr>
				}
				@if (Model.Entries.Count == 0)
				{
					<tr>
						<td colspan="5"><p>No timesheet entries found for selected week</p></td>
					</tr>


				}
			</tbody>
		</table>
	</div>

</div>